library(data.table)
dat = lapply(list.files(path = "healthcare2", pattern = "*.csv"),
fread)
library(data.table)
dat = lapply(list.files(path = "healthcare2/", pattern = "*.csv"),
fread)
library(data.table)
dat = lapply(list.files(path = "healthcare2/", pattern = "*.csv"),
fread)
library(data.table)
dat = lapply(list.files(path = "./healthcare2", pattern = "*.csv"),
fread)
library(data.table)
dat = lapply(list.files(path = "./healthcare2/", pattern = "*.csv"),
fread)
list.files(path = "./healthcare2/")
list.files(path = "./healthcare2/", pattern = "*.csv")
lapply(list.files(path = "./healthcare2/", pattern = "*.csv"),
fread)
list.files(path = "healthcare2/", pattern = "*.csv")
list.files(path = "healthcare2", pattern = "*.csv")
lapply(list.files(path = "healthcare2", pattern = "*.csv"),
fread)
list.files(path = "healthcare2", pattern = "*.csv")[1]
fread(list.files(path = "healthcare2", pattern = "*.csv")[1])
fread(list.files(path = "healthcare2", pattern = "*.csv")[2])
dat = lapply(paste0(datapath, list.files(path = datapath, pattern = "*.csv")),
fread)
datapath = "healthcare2"
dat = lapply(paste0(datapath, list.files(path = datapath, pattern = "*.csv")),
fread)
datapath = "healthcare2/"
dat = lapply(paste0(datapath, list.files(path = datapath, pattern = "*.csv")),
fread)
names(dat)
str(dat)
csv_files = list.files(path = datapath, pattern = "*.csv")
parse(csv_files[1])
gsub(".csv", "", csv_files[1])
parse(gsub(".csv", "", csv_files[1]))
parse(gsub(".csv", "", csv_files[1])) = fread(paste0(data_path, csv_files[1]))
data_path = "healthcare2/"
csv_files = list.files(path = datapath, pattern = "*.csv")
data_path = "healthcare2/"
csv_files = list.files(path = datapath, pattern = "*.csv")
parse(gsub(".csv", "", csv_files[1])) = fread(paste0(data_path, csv_files[1]))
assign(paste0("x", "y"), 1)
assign(gsub(".csv", "", csv_files[1]), fread(paste0(data_path, csv_files[1])))
seq_len(csv_files)
seq_along(csv_files)
purrr::map(seq_along(csv_files), readallcsv)
readallcsv = function(i){
assign(
gsub(".csv", "", csv_files[i]),
fread(paste0(data_path, csv_files[i]))
)
}
purrr::map(seq_along(csv_files), readallcsv)
readallcsv(1)
readallcsv(2)
readallcsv = function(i){
assign(
gsub(".csv", "", csv_files[i]),
fread(paste0(data_path, csv_files[i])),
envir = parent.frame()
)
}
purrr::map(seq_along(csv_files), readallcsv)
readallcsv(2)
readallcsv(3)
purrr::map_int(seq_along(csv_files), readallcsv)
for (i in seq_along(csv_files)) {
readallcsv(i)
}
rm(list = ls())
readallcsv = function(i){
return(assign(
gsub(".csv", "", csv_files[i]),
fread(paste0(data_path, csv_files[i])),
envir = parent.frame()
))
}
purrr::map(seq_along(csv_files), readallcsv)
library(data.table)
data_path = "healthcare2/"
csv_files = list.files(path = datapath, pattern = "*.csv")
readallcsv = function(i){
return(assign(
gsub(".csv", "", csv_files[i]),
fread(paste0(data_path, csv_files[i])),
envir = parent.frame()
))
}
purrr::map(seq_along(csv_files), readallcsv)
rm(list = ls())
library(data.table)
data_path = "healthcare2/"
csv_files = list.files(path = data_path, pattern = "*.csv")
readallcsv = function(i){
return(assign(
gsub(".csv", "", csv_files[i]),
fread(paste0(data_path, csv_files[i])),
envir = parent.frame()
))
}
purrr::map(seq_along(csv_files), readallcsv)
for (i in seq_along(csv_files))  readallcsv(i)
head(Patient)
head(Mortality)
View(Mortality)
table(substr(Mortality$DateOfDeath, 1, 4))
class(Mortality)
q1 = Patient[Mortality]
q1 = Patient[Mortality, on = "PatientID"]
q1 = Mortality[Patient, on = "PatientID"]
table(q1$Gender)
q1 = Mortality[Patient, on = "PatientID"][!Gender %in% c("female", "male"), Gender := "other"]
table(q1$Gender)
?ymd
tables()
q1[, sum(is.na(DateOfDeath))/.N, by = Gender]
7094/20000
q1[, sum(is.na(DateOfDeath))/.N]
View(q1)
q1[, sum(!is.na(DateOfDeath))/.N]
q1[, sum(!is.na(DateOfDeath))/.N, by = Gender]
q1[, death_percent = sum(!is.na(DateOfDeath))/.N, by = Gender][order(-death_percent)]
q1[, death_percent = sum(!is.na(DateOfDeath))/.N, by = Gender]
q1[, death_percent := sum(!is.na(DateOfDeath))/.N, by = Gender][order(-death_percent)]
q1[, .(death_percent = sum(!is.na(DateOfDeath))/.N), by = Gender][order(-death_percent)]
?melt
head(OutpatientVisit)
q2 = melt(OutpatientVisit, measure = "^ICD_10", value.name = "PatientID")
?patterns
q2 = melt(OutpatientVisit, measure = patterns("^ICD_10"), value.name = "PatientID")
View(q2)
identical(OutpatientVisit, q2)
melt(OutpatientVisit, measure = patterns("^ICD_10"), value.name = "PatientID")
q2 = melt(OutpatientVisit, measure = patterns("^ICD_10"), value.name = "VisitID")
q2 = melt(OutpatientVisit, measure = patterns("^ICD_10"), value.name = c("VisitID", "PatientID"))
patterns("^ICD_10")
OutpatientVisit[!.(PatientID)]
q2 = melt(OutpatientVisit, measure = patterns("^ICD_10"), id.vars = c("VisitID", "PatientID"))
View(q2)
q2 = melt(OutpatientVisit, measure = patterns("^ICD_10"), id.vars = c("VisitID", "PatientID"), variable.name = "ICD10")
q2 = melt(OutpatientVisit, measure.vars = patterns("^ICD_10"), id.vars = c("VisitID", "PatientID"), variable.name = "ICD10")
View(q2)
q2 = melt(OutpatientVisit, measure.vars = patterns("^ICD10"), id.vars = c("VisitID", "PatientID"), variable.name = "ICD10")
q2 = melt(OutpatientVisit, measure = patterns("^ICD10"), value.name = c("VisitID", "PatientID"))
q2 = melt(OutpatientVisit, measure = patterns("^ICD10"))
View(q2)
q3 = melt(OutpatientVisit, measure = patterns("^ICD10"), id.vars = c("VisitID", "PatientID"))
View(q3)
head(DiseaseMap)
q2 = DiseaseMap[q2, on = "ICD10"]
q2 = melt(
OutpatientVisit,
measure.vars = patterns("^ICD10"),
id.vars = c("VisitID", "PatientID"),
variable.name = "ICD10"
)
q2 = DiseaseMap[q2, on = "ICD10"]
View(q2)
example(data.table)
names(q2)
names(q2)
q2 = DiseaseMap[OutpatientVisit, on = "ICD10"][, .N, by = c(VisitID, PatientID)]
OutpatientVisit = melt(
OutpatientVisit,
measure.vars = patterns("^ICD10"),
id.vars = c("VisitID", "PatientID"),
variable.name = "ICD10"
)
q2 = DiseaseMap[OutpatientVisit, on = "ICD10"][, .N, by = c(VisitID, PatientID)]
DiseaseMap[OutpatientVisit, on = "ICD10"]
q2 = DiseaseMap[OutpatientVisit, on = "ICD10"][, .N, by = .(VisitID, PatientID)]
View(q2)
DiseaseMap[OutpatientVisit, on = "ICD10"]
OutpatientVisit
OutpatientVisit = melt(
OutpatientVisit,
measure.vars = patterns("^ICD10"),
id.vars = c("VisitID", "PatientID"),
variable.name = "ICD10"
)
OutpatientVisit
OutpatientVisit = melt(
OutpatientVisit,
measure.vars = patterns("^ICD10"),
id.vars = c("VisitID", "PatientID"),
value.name = "ICD10"
)
DiseaseMap[OutpatientVisit, on = "ICD10"]
OutpatientVisit
library(data.table)
data_path = "healthcare2/"
csv_files = list.files(path = data_path, pattern = "*.csv")
readallcsv = function(i){
assign(
gsub(".csv", "", csv_files[i]),
fread(paste0(data_path, csv_files[i])),
envir = parent.frame()
)
}
for (i in seq_along(csv_files))  readallcsv(i)
OutpatientVisit = melt(
OutpatientVisit,
measure.vars = patterns("^ICD10"),
id.vars = c("VisitID", "PatientID"),
value.name = "ICD10"
)
OutpatientVisit
DiseaseMap[OutpatientVisit, on = "ICD10"]
q2 = DiseaseMap[OutpatientVisit, on = "ICD10"][, .N, by = .(PatientID, Condition)]
View(q2)
q2 = DiseaseMap[OutpatientVisit, on = "ICD10"][, .N, by = .(PatientID, Condition)][Patient, on = "PatientID"]
View(q2)
Patient[!Gender %in% c("female", "male"), Gender := "other"]
library(data.table)
data_path = "healthcare2/"
csv_files = list.files(path = data_path, pattern = "*.csv")
readallcsv = function(i){
assign(
gsub(".csv", "", csv_files[i]),
fread(paste0(data_path, csv_files[i])),
envir = parent.frame()
)
}
for (i in seq_along(csv_files))  readallcsv(i)
Patient[!Gender %in% c("female", "male"), Gender := "other"]
q1 = Mortality[Patient, on = "PatientID"]
q1[, .(death_percent = sum(!is.na(DateOfDeath))/.N), by = Gender][order(-death_percent)]
Npatients = nrow(Patient)
q2[sum(!is.na(DiseaseMapID))/Npatients, by = .(Condition, Gender), ]
q2 = DiseaseMap[OutpatientVisit, on = "ICD10"][, .N, by = .(PatientID, Condition)][Patient, on = "PatientID"]
q2[sum(!is.na(DiseaseMapID))/Npatients, by = .(Condition, Gender)]
q2[,sum(!is.na(DiseaseMapID))/Npatients, by = .(Condition, Gender)]
q2 = DiseaseMap[OutpatientVisit, on = "ICD10"][, .N, by = .(PatientID, Condition)][Patient, on = "PatientID"]
DiseaseMap
OutpatientVisit
library(data.table)
data_path = "healthcare2/"
csv_files = list.files(path = data_path, pattern = "*.csv")
readallcsv = function(i){
assign(
gsub(".csv", "", csv_files[i]),
fread(paste0(data_path, csv_files[i])),
envir = parent.frame()
)
}
for (i in seq_along(csv_files))  readallcsv(i)
Patient[!Gender %in% c("female", "male"), Gender := "other"]
q1 = Mortality[Patient, on = "PatientID"]
q1[, .(death_percent = sum(!is.na(DateOfDeath))/.N), by = Gender][order(-death_percent)]
OutpatientVisit = melt(
OutpatientVisit,
measure.vars = patterns("^ICD10"),
id.vars = c("VisitID", "PatientID"),
value.name = "ICD10"
)
Npatients = nrow(Patient)
q2 = DiseaseMap[OutpatientVisit, on = "ICD10"][, .N, by = .(PatientID, Condition)][Patient, on = "PatientID"]
q2[,sum(!is.na(DiseaseMapID))/Npatients, by = .(Condition, Gender)]
q2
q2[,sum(!is.na(Condition))/Npatients, by = .(Condition, Gender)]
q2[,.(condition_percent = sum(!is.na(Condition))/Npatients), by = .(Condition, Gender)][order(Condition, Gender)]
q2[,.(condition_percent = sum(!is.na(Condition))/Npatients), by = .(Condition, Gender)][order(Condition, Gender)][condition_percent := paste0(condition_percent*100, "%")]
q2[,.(condition_percent = sum(!is.na(Condition))/Npatients), by = .(Condition, Gender)][order(Condition, Gender)]
q2[,.(condition_percent = sum(!is.na(Condition))/Npatients), by = .(Condition, Gender)][order(Condition, Gender)][,condition_percent := paste0(condition_percent*100, "%")]
q2[,.(condition_percent = sum(!is.na(Condition))/Npatients), by = .(Condition, Gender)][order(Condition, Gender)][,condition_percent = paste0(condition_percent*100, "%")]
q2 = DiseaseMap[OutpatientVisit, on = "ICD10"][, .N, by = .(PatientID, Condition)][Patient, on = "PatientID"]
q2[,.(condition_percent = sum(!is.na(Condition))/Npatients), by = .(Condition, Gender)][order(Condition, Gender)][,.(condition_percent = paste0(condition_percent*100, "%"))]
q2 = DiseaseMap[OutpatientVisit, on = "ICD10"][, .N, by = .(PatientID, Condition)][Patient, on = "PatientID"]
q2[,.(condition_N = sum(!is.na(Condition))), by = .(Condition, Gender)][order(Condition, Gender)][,condition_percent := paste0(condition_N*100/Npatients, "%")]
q2
q2 = DiseaseMap[OutpatientVisit, on = "ICD10"][, .N, by = .(PatientID, Condition)][Patient, on = "PatientID"]
q2
q2[,.(condition_N = sum(!is.na(Condition))), by = .(Condition, Gender)][order(Condition, Gender)]
q2 = DiseaseMap[OutpatientVisit, on = "ICD10"][, .N, by = .(PatientID, Condition)][Patient, on = "PatientID"]
q2 = DiseaseMap[OutpatientVisit, on = "ICD10"][, .N, by = .(PatientID, Condition)][Patient, on = "PatientID"]
q2 = DiseaseMap[OutpatientVisit, on = "ICD10"][, .N, by = .(PatientID, Condition)][Patient, on = "PatientID"]
q2[,.(condition_N = .N), by = .(Condition, Gender)][order(Condition, Gender)]
q2[,condition_percent := paste0(condition_N*100/Npatients, "%")]
q2[,condition_percent := paste0(condition_N*100/Npatients, "%")]
q2[condition_percent := paste0(condition_N*100/Npatients, "%")]
class(q2)
q2[condition_percent := paste0(condition_N*100/nrow(Patient), "%")]
q2[condition_percent := condition_N*100/nrow(Patient)]
q2[.(condition_percent = condition_N*100/nrow(Patient))]
q2
q2 = DiseaseMap[OutpatientVisit, on = "ICD10"][, .N, by = .(PatientID, Condition)][Patient, on = "PatientID"]
q2[,.(condition_N = .N), by = .(Condition, Gender)][order(Condition, Gender)]
q2[condition_percent := paste0(condition_N*100/nrow(Patient), "%")]
q2[,condition_percent := paste0(condition_N*100/nrow(Patient), "%")]
q2[,.(condition_N = .N), by = .(Condition, Gender)][order(Condition, Gender)]
q2[,.(condition_N = .N), by = .(Condition, Gender)][order(Condition, Gender)][,condition_percent := paste0(condition_N*100/nrow(Patient), "%")]
q2
q2 = DiseaseMap[OutpatientVisit, on = "ICD10"][, .N, by = .(PatientID, Condition)][Patient, on = "PatientID"]
q2[,.(condition_N = .N), by = .(Condition, Gender)][,condition_percent := paste0(condition_N*100/nrow(Patient), "%")][order(Condition, Gender)]
q3 = Mortality[Patient, on = "PatientID"]
View(q3)
head(OutpatientVisit)
library(data.table)
data_path = "healthcare2/"
csv_files = list.files(path = data_path, pattern = "*.csv")
readallcsv = function(i){
assign(
gsub(".csv", "", csv_files[i]),
fread(paste0(data_path, csv_files[i])),
envir = parent.frame()
)
}
for (i in seq_along(csv_files))  readallcsv(i)
head(OutpatientVisit)
q3[death_year := as.integer(substr(DateOfDeath))]
q3[,death_year := as.integer(substr(DateOfDeath))]
q3[,death_year := as.integer(substr(DateOfDeath, 1, 4))]
q3[,sum(is.na(DateOfDeath)), by = death_year]
q3[,.N, by = death_year]
q3[,.N, by = death_year][order(death_year)]
q3[,.N, by = death_year][order(death_year)][,cum_death = cumsum(N)]
q3[,.N, by = death_year][order(death_year)][,cum_death := cumsum(N)]
t = q3[,.N, by = death_year][order(death_year)][,cum_death := cumsum(N)]
View(t)
t = q3[,.N, by = death_year][order(death_year)][,`:=`(cum_death := cumsum(N),
atrisk = 20000 - cum_death)]
t = q3[,.N, by = death_year][order(death_year)][,`:=`(cum_death := cumsum(N),
atrisk := 20000 - cum_death)]
t = q3[,.N, by = death_year][order(death_year)][,`:=`(cum_death = cumsum(N),
atrisk = 20000 - cum_death)]
t = q3[,.N, by = death_year][order(death_year)]
t[,`:=`(cum_death = cumsum(N), atrisk = 20000 - cum_death)]
t[,c("cum_death", "atrisk") = c(cumsum(N), 20000 - cum_death)]
t[,c("cum_death", "atrisk") := c(cumsum(N), 20000 - cum_death)]
t[,cum_death := cumsum(N)]
View(t)
t[, cum_death := cumsum(N)][, atrisk = 20000 - cum_death]
t[, cum_death := cumsum(N)][, atrisk := 20000 - cum_death]
t[, cum_death := cumsum(N)][, atrisk := 20000 - cum_death]
View(t)
t[, cum_death := cumsum(N)][, atrisk := 20000 - cum_death][, mortality_rate := N_death*100/atrisk]
t = q3[,N_death = .N, by = death_year][order(death_year)]
t[, cum_death := cumsum(N)][, atrisk := 20000 - cum_death][, mortality_rate := N_death*100/atrisk]
t = q3[,N_death = .N, by = death_year][order(death_year)]
t = q3[,N_death := .N, by = death_year][order(death_year)]
View(t)
t = q3[,N_death := .N, by = death_year][order(death_year)]
q3[,N_death := .N, by = death_year]
t = q3[,.(N_death = .N), by = death_year][order(death_year)]
t[, cum_death := cumsum(N)][, atrisk := 20000 - cum_death][, mortality_rate := N_death*100/atrisk]
t[, cum_death := cumsum(N_death)][, atrisk := 20000 - cum_death][, mortality_rate := N_death*100/atrisk]
View(t)
require(ggplot2)
q3 = Mortality[Patient, on = "PatientID"]
q3[, year := as.integer(substr(DateOfDeath, 1, 4))]
t = q3[, .(N_death = .N), by = year][order(death_year)]
t[, cum_death := cumsum(N_death)][, atrisk := 20000 - cum_death][, mortality_rate := N_death*100/atrisk]
t = q3[, .(N_death = .N), by = year][order(year)]
t = q3[, .(N_death = .N), by = year][order(year)]
t[, cum_death := cumsum(N_death)][, atrisk := 20000 - cum_death][, mortality_rate := N_death*100/atrisk]
ggplot(t, aes(year, mortality_rate)) + geom_point() + geom_line()
ggplot(t, aes(year, mortality_rate)) +
geom_point() + geom_line()
